---
layout: post
title:  "ARM的三个寄存器SP-LR-PC"
categories: Linux-Sys
tags:  linux
author: Phone
---

* content
{:toc}






深入理解ARM的这三个寄存器，对编程以及操作系统的移植都有很大的裨益。

## 1、堆栈指针r13（SP） ##





每一种异常模式都有其自己独立的r13，它通常指向异常模式所专用的堆栈，也就是说五种异常模式、非异常模式（用户模式和系统模式），都有各自独立的堆栈，用不同的堆栈指针来索引。这样当ARM进入异常模式的时候，程序就可以把一般通用寄存器压入堆栈，返回时再出栈，保证了各种模式下程序的状态的完整性。

## 2、连接寄存器r14（LR） ##
每种模式下r14都有自身版组，它有两个特殊功能。

（1）保存子程序返回地址。使用BL或BLX时，跳转指令自动把返回地址放入r14中；子程序通过把r14复制到PC来实现返回，通常用下列指令之一：
        MOV PC, LR 
        BX LR

通常子程序这样写，保证了子程序中还可以调用子程序。
        stmfd sp!, {lr}
        ……
        ldmfd sp!, {pc}

（2）当异常发生时，异常模式的r14用来保存异常返回地址，将r14如栈可以处理嵌套中断。

## 3、程序计数器r15（PC） ##
PC是有读写限制的。当没有超过读取限制的时候，读取的值是指令的地址加上8个字节，由于ARM指令总是以字对齐的，故bit[1:0]总是00。当用str或stm存储PC的时候，偏移量有可能是8或12等其它值。在V3及以下版本中，写入bit[1:0]的值将被忽略，而在V4及以上版本写入r15的bit[1:0]必须为00，否则后果不可预测。
